# Development Log

> å¼€å‘æ—¥å¿— - è®°å½•æ¯æ¬¡æ”¹è¿›ã€æµ‹è¯•æ•ˆæœå’Œä¸‹ä¸€æ­¥è®¡åˆ’
> ä½¿ç”¨ `/log` å‘½ä»¤æ·»åŠ æ–°è®°å½•ï¼Œ`/devlog` å‘½ä»¤æŸ¥çœ‹å†å²

---

## 2025-12-03 00:28

**æäº¤çŠ¶æ€**: âœ… å·²æäº¤ (commit: 9dfa108)

### æ”¹è¿›å†…å®¹
- é¡¹ç›®æ–‡ä»¶ç»“æ„æ•´ç†ä¸é‡ç»„
- ç§»åŠ¨3ä¸ªæ ¡å‡†è„šæœ¬åˆ° `aad_edge_pushing/pde/calibration/`
  - `calibrate_vol_surface_fast.py` â†’ `calibrate_fast.py`
  - `calibrate_vol_surface_ep.py` â†’ `calibrate_with_ep.py`
  - `calibrate_vol_surface_improved.py` â†’ `calibrate_comparison.py`
- å½’æ¡£12ä¸ªå®éªŒæ€§Cythonæ–‡ä»¶åˆ° `edge_pushing/archive/experimental/`
  - 6ä¸ªOpenMPå˜ä½“ (algo4_openmp*.pyx)
  - 6ä¸ªå…¶ä»–å®éªŒæ€§å˜ä½“
- åˆ é™¤25ä¸ªæ–‡ä»¶ï¼š
  - TIER 1: 6ä¸ªå®Œå…¨æœªå¼•ç”¨æ–‡ä»¶ (algo3_block.py, algo4_adjmatrix.py, algo4_batch_parallel.py, symm_sparse_adjlist_original.py, setup_algo4_cython.py, setup_cpp_fixed.py)
  - TIER 3: 7ä¸ªå­¤ç«‹è®¾ç½®è„šæœ¬ (setup_algo4_openmp.py, setup_openmp_v3.py, setup_cython_cpp.py, setup_batch_parallel.py, setup_sparse_openmp.py, setup_v2.py, setup_cython.py)
  - TIER 2: 12ä¸ªå·²å½’æ¡£æ–‡ä»¶
- æ›´æ–° `edge_pushing/__init__.py` ç§»é™¤å·²åˆ é™¤æ¨¡å—çš„å¯¼å‡º
- åˆ›å»º3ä¸ªæ–°setupè„šæœ¬å¹¶æˆåŠŸç¼–è¯‘Cythonæ¨¡å—
  - setup_algo4_simple.py â†’ algo4_cython_simple.so (802KB)
  - setup_symm_sparse.py â†’ symm_sparse_adjlist.so (701KB)
  - setup_symm_sparse_cpp.py â†’ symm_sparse_adjlist_cpp.so (1.4MB)

### æµ‹è¯•æ•ˆæœ
- `compute_pde_hessian.py` è¿è¡ŒæˆåŠŸï¼ŒéªŒè¯æ— ç ´åæ€§æ”¹åŠ¨
  - Option Price: 10.450115 (BS 10.450584, è¯¯å·® 0.000469)
  - Hessian: 10Ã—10, 36% sparse, æ¡ä»¶æ•° 1.25
  - è®¡ç®—æ—¶é—´: 84.77s
- edge_pushing/ ç›®å½•ä» ~45ä¸ªæ–‡ä»¶å‡å°‘åˆ° ~20ä¸ªæ ¸å¿ƒæ–‡ä»¶ (**å‡å°‘ 56%**)
- æˆåŠŸç¼–è¯‘3ä¸ªCythonæ¨¡å—ï¼Œæ€»å¤§å° 2.9MB
- é¡¹ç›®ç»“æ„æ›´æ¸…æ™°ï¼šæ ¡å‡†åŠŸèƒ½é›†ä¸­åœ¨ pde/calibration/, æ ¸å¿ƒä»£ç åœ¨ edge_pushing/, å®éªŒæ€§ä»£ç å½’æ¡£

### æ–‡ä»¶ç»“æ„æ›´æ–°

```
aad_edge_pushing/
â”œâ”€â”€ aad/                          # æ ¸å¿ƒAADåº“
â”‚   â”œâ”€â”€ core/                     # ADæ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ ops/                      # ADæ“ä½œç¬¦
â”‚   â””â”€â”€ taylor.py                 # Taylor 2é˜¶å‰å‘æ¨¡å¼
â”œâ”€â”€ edge_pushing/                 # EPç®—æ³•å®ç° (56%â†“)
â”‚   â”œâ”€â”€ algo4_cython_simple.pyx  # ä¸»è¦Cythonå®ç° â­
â”‚   â”œâ”€â”€ symm_sparse_adjlist.pyx  # ç¨€ç–é‚»æ¥è¡¨ â­
â”‚   â”œâ”€â”€ symm_sparse_adjlist_cpp.pyx  # C++ä¼˜åŒ–ç‰ˆ â­
â”‚   â”œâ”€â”€ setup_*.py               # æ–°å¢3ä¸ªsetupè„šæœ¬ âœ¨
â”‚   â””â”€â”€ archive/experimental/    # 12ä¸ªå®éªŒæ€§æ–‡ä»¶å½’æ¡£ ğŸ“¦
â””â”€â”€ pde/                          # PDEåº”ç”¨
    â”œâ”€â”€ calibration/              # æ ¡å‡†æ¨¡å— (æ–°å¢3ä¸ª) âœ¨
    â”‚   â”œâ”€â”€ calibrate_fast.py    # ç§»å…¥ â†
    â”‚   â”œâ”€â”€ calibrate_with_ep.py # ç§»å…¥ â†
    â”‚   â””â”€â”€ calibrate_comparison.py # ç§»å…¥ â†
    â”œâ”€â”€ methods/                  # å„ç§æ–¹æ³•å®ç°
    â””â”€â”€ models/                   # æ³¢åŠ¨ç‡æ¨¡å‹ (âœ…ä¿ç•™)
```

### Insights
- **é¡¹ç›®ç»“æ„ç»„ç»‡åŸåˆ™**: calibrationæ˜¯PDEåº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½è€Œéä»…ä»…æ¼”ç¤ºè„šæœ¬ï¼Œåº”è¯¥æ¨¡å—åŒ–æ”¾å…¥ pde/calibration/ ä¸ç°æœ‰çš„ bspline_calibrator.py ä¸€èµ·ï¼Œå½¢æˆå®Œæ•´çš„æ ¡å‡†æ¨¡å—
- **ä¾èµ–åˆ†æçš„é‡è¦æ€§**: ä½¿ç”¨ `grep -r "from.*import"` åˆ†æå¯¼å…¥å…³ç³»é¿å…è¯¯åˆ ï¼Œå‘ç° models/ ç›®å½•è¢« 5+ ä¸ªæ–‡ä»¶å¯¼å…¥ï¼ˆä¹‹å‰ä»¥ä¸ºæœªä½¿ç”¨ï¼‰
- **åˆ†å±‚æ¸…ç†ç­–ç•¥**: TIER 1ï¼ˆ0å¼•ç”¨ï¼‰ç«‹å³åˆ é™¤ã€TIER 2ï¼ˆå®éªŒæ€§ä½†æœ‰å‚è€ƒä»·å€¼ï¼‰å½’æ¡£ä¿ç•™ã€TIER 3ï¼ˆå­¤ç«‹é…ç½®æ–‡ä»¶ï¼‰åˆ é™¤ã€‚æ—¢ä¿æŒæ•´æ´åˆä¸ä¸¢å¤±å†å²
- **Cythonç¼–è¯‘é™·é˜±**: .pyxæ–‡ä»¶ç¼–è¯‘æ—¶å¦‚æœåŒæ—¶åŒ…å«ç”Ÿæˆçš„ .cpp æ–‡ä»¶ä¼šå¯¼è‡´ "multiple definition" é“¾æ¥é”™è¯¯ï¼Œsetup.py çš„ sources åº”åªåŒ…å« .pyx æ–‡ä»¶
- **importè·¯å¾„æ›´æ–°**: æ–‡ä»¶ç§»åŠ¨åéœ€è¦æ›´æ–° sys.path.insert() ä»ç›¸å¯¹äºæ ¹ç›®å½•æ”¹ä¸ºç›¸å¯¹äºæ–°ä½ç½® (parent.parent.parent...)

### ä¸‹ä¸€æ­¥è®¡åˆ’
- æäº¤æ–‡ä»¶ç»“æ„æ•´ç†çš„æ”¹åŠ¨åˆ° git
- è€ƒè™‘æ·»åŠ é¡¹ç›®ç»“æ„æ–‡æ¡£ (ARCHITECTURE.md) è¯´æ˜ä¸‰å±‚æ¶æ„
- å®Œæˆ EP vs Taylor vs Bumping2 çš„å®Œæ•´æ€§èƒ½åŸºå‡†æµ‹è¯•
- å¯èƒ½çš„å¤§è§„æ¨¡åº”ç”¨æµ‹è¯•ï¼ˆæ›´å¤§å‚æ•°è§„æ¨¡çš„PDE Hessianè®¡ç®—ï¼‰

---

## 2025-12-03 05:30

**æäº¤çŠ¶æ€**: âœ… å·²æäº¤ (commit: 7b54bf0)

### æ”¹è¿›å†…å®¹
- å®ç°çœŸå®æœŸæƒæ•°æ®çš„æ³¢åŠ¨ç‡æ›²é¢æ ¡å‡†
- éªŒè¯ EP Hessian åœ¨é‡‘èåº”ç”¨ä¸­çš„æ­£ç¡®æ€§
- æ¯”è¾ƒä¸åŒ B-spline ç½‘æ ¼é…ç½®çš„æ‹Ÿåˆæ•ˆæœ
- ç¼–è¯‘ Cython EP æ¨¡å— (algo4_cython_simple, symm_sparse_adjlist_cpp)
- å®Œæˆ PDE+B-spline V(w) çš„ Hessian è®¡ç®—

### æ³¢åŠ¨ç‡æ›²é¢æ ¡å‡†

#### æ•°æ®
- SPY æœŸæƒæ•°æ®: `UnderlyingOptionsEODQuotes_2025-02-06.csv`
- æ ‡çš„ä»·æ ¼: $6081.76
- æœ‰æ•ˆæœŸæƒæ•°: 5,405

#### EP Hessian éªŒè¯
- EP vs æ•°å€¼ Hessian è¯¯å·®: **10â»â¸ ~ 10â»Â¹â´**
- æµ‹è¯•é…ç½®: 20 å‚æ•° (5Ã—4), 100 æ•°æ®ç‚¹
- ç»“æ„å®Œå…¨åŒ¹é…ï¼ŒéªŒè¯ EP åœ¨çœŸå®é‡‘èé—®é¢˜ä¸Šæ­£ç¡®

#### B-spline ç½‘æ ¼é…ç½®æ¯”è¾ƒ

| é…ç½® | å‚æ•°æ•° | æ€» RMSE | çŸ­æœŸ RMSE |
|------|--------|---------|-----------|
| Uniform (5Ã—4) | 42 | 0.0156 | 0.0164 |
| **Dense Short-T (5Ã—6)** | 56 | **0.0148** | **0.0150** |
| Dense M + Short-T (7Ã—6) | 72 | 0.0149 | 0.0152 |
| Weighted Short-T (5Ã—4) | 42 | 0.0153 | 0.0158 |

#### å…³é”®å‘ç°
- Dense Short-T é…ç½®æœ€ä¼˜ï¼ŒçŸ­æœŸ RMSE é™ä½ 8.5%
- å¢åŠ  moneyness èŠ‚ç‚¹æ— æ˜¾è‘—æ”¹å–„
- åŠ æƒæ–¹æ³•æ•ˆæœæœ‰é™ï¼Œé—®é¢˜æ ¹æºæ˜¯èŠ‚ç‚¹åˆ†å¸ƒ

#### PDE+B-spline Hessian è®¡ç®—

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æœŸæƒä»·æ ¼ (PDE) | 10.4501 |
| BS è§£æä»·æ ¼ | 10.4506 |
| ä»·æ ¼è¯¯å·® | 0.0005 |
| Hessian ç»´åº¦ | 10Ã—10 |
| è®¡ç®—æ—¶é—´ (Cython) | 84.6s |
| ç¨€ç–æ€§ | 36% |
| æ¡ä»¶æ•° | 1.25 |

### ç”Ÿæˆçš„æ–‡ä»¶
- `calibrate_vol_surface_fast.py` - å¿«é€Ÿæ ¡å‡†è„šæœ¬
- `calibrate_vol_surface_ep.py` - EP Hessian éªŒè¯è„šæœ¬
- `calibrate_vol_surface_improved.py` - ç½‘æ ¼é…ç½®æ¯”è¾ƒè„šæœ¬
- `compute_pde_hessian.py` - PDE Hessian è®¡ç®—è„šæœ¬
- `vol_surface.png`, `vol_smiles.png` - æ³¢åŠ¨ç‡æ›²é¢å¯è§†åŒ–
- `hessian_comparison.png` - EP vs æ•°å€¼ Hessian æ¯”è¾ƒ
- `vol_smiles_comparison.png`, `rmse_comparison.png` - é…ç½®æ¯”è¾ƒ
- `pde_hessian.png` - PDE Hessian å¯è§†åŒ–

### Insights
- **EP åœ¨çœŸå®é‡‘èé—®é¢˜ä¸Šçš„ç²¾åº¦**: EP vs æ•°å€¼ Hessian è¯¯å·®è¾¾åˆ° 10â»â¸ ~ 10â»Â¹â´ï¼Œè¿œè¶…é‡‘èåº”ç”¨éœ€æ±‚
- **B-spline èŠ‚ç‚¹åˆ†å¸ƒçš„é‡è¦æ€§**: çŸ­æœŸæœŸæƒæ³¢åŠ¨ç‡æ›²ç‡æ›´é™¡ï¼Œéœ€è¦æ›´å¯†çš„æ—¶é—´èŠ‚ç‚¹æ¥æ•æ‰ï¼ŒåŠ æƒæ–¹æ³•æ— æ³•æ›¿ä»£åˆç†çš„èŠ‚ç‚¹åˆ†å¸ƒ
- **PDE Hessian çš„ç¨€ç–ç»“æ„**: B-spline ç´§æ”¯æ’‘ç‰¹æ€§å¯¼è‡´ 36% ç¨€ç–æ€§ï¼Œä¸­å¿ƒåŒºåŸŸï¼ˆATMï¼‰å¯¹æ³¢åŠ¨ç‡æœ€æ•æ„Ÿ
- **Hessian ä¸å®šæ€§**: æœŸæƒä»·æ ¼å¯¹æ³¢åŠ¨ç‡çš„äºŒé˜¶å¯¼æ•°å¯æ­£å¯è´Ÿï¼Œåæ˜ äº†æœŸæƒä»·å€¼å‡½æ•°çš„å‡¸æ€§å˜åŒ–

### ä¸‹ä¸€æ­¥è®¡åˆ’
1. ~~EP vs Taylor vs Bumping2 æ€§èƒ½åŸºå‡†æµ‹è¯•~~ (å·²å®ŒæˆåŸºç¡€æµ‹è¯•)
2. ~~Newton-Raphson äºŒé˜¶ä¼˜åŒ–~~ (è·³è¿‡)
3. ~~PDE+B-spline V(w) çš„ Hessian è®¡ç®—~~ (å·²å®Œæˆ)

---

## 2025-12-03 04:00

**æäº¤çŠ¶æ€**: âœ… å·²æäº¤ (commit: 30487e2)

### æ”¹è¿›å†…å®¹
- å°† Taylor ä»£ç ä» `jpm_practicum` æå–åˆ° `aad_edge_pushing/aad/taylor.py`
- ä¿®å¤ `aad_edge_pushing` çš„ EP bugï¼š
  - `use_tape()` å…¼å®¹æ€§é—®é¢˜ï¼ˆarithmetic.py, transcendental.py, special.py, engine.pyï¼‰
  - Creating é˜¶æ®µåŒå˜é‡å› å­2é—®é¢˜ï¼ˆengine.py ç¬¬458-461è¡Œï¼‰

### æµ‹è¯•æ•ˆæœ
- EP vs Taylor ç²¾åº¦å®Œå…¨åŒ¹é…ï¼ˆè¯¯å·® <1e-15ï¼‰
- æµ‹è¯•é€šè¿‡å‡½æ•°ï¼š
  - `f(x) = sum(xáµ¢Â²)` â†’ Hessian = 2I âœ“
  - `f(x) = sqrt(1 + Î£xáµ¢Â²)` âœ“
  - `f(x) = exp(Î£xáµ¢Â²)` âœ“
  - `f(x) = log(1 + Î£xáµ¢Â²)` âœ“
  - `f(x) = (Î£xáµ¢Â²)Â²` âœ“
  - `f(x) = xÂ³` via x*x*x âœ“

### Insights
- **Bug æ ¹å› **ï¼š`x*x` çš„ cross term `{("cross", (0,1)): 1.0}` ä¸¤ä¸ª parent éƒ½æ˜¯åŒä¸€ä¸ª x
- `frozenset({id(x), id(x)})` åç¼©ä¸º singleton `frozenset({id(x)})`
- éœ€è¦ factor 2 è¡¥å¿ï¼š`(a+a)Â² = 2aÂ²`
- **é‡è¦**ï¼šPushing é˜¶æ®µå’Œ Creating é˜¶æ®µ**éƒ½éœ€è¦**å¤„ç†åŒå˜é‡æƒ…å†µ

### ä¸‹ä¸€æ­¥è®¡åˆ’
1. åˆ†æ Taylor, EP, Bumping2 åœ¨ PDE+B-spline è¿è¡Œé€Ÿåº¦å·®å¼‚çš„åŸå› 
2. ä½¿ç”¨çœŸå®æ•°æ® `UnderlyingOptionsEODQuotes_2025-02-06` è¿›è¡Œ calibration
3. ç»˜åˆ¶æ³¢åŠ¨ç‡æ›²é¢å’Œå®é™… Hessian å›¾

---

## 2025-12-03 02:30

### B-spline PDEæ¨¡å‹éªŒè¯

#### æµ‹è¯•ç¯å¢ƒ
- Grid: M=20, N=10
- B-spline configs: 4x4 åˆ° 12x12

#### ç²¾åº¦éªŒè¯

å¯¹è§’çº¿å’Œäº¤å‰é¡¹Hessianä¸Bumping2å®Œå…¨åŒ¹é…ï¼š
- å¯¹è§’çº¿æœ€å¤§ç›¸å¯¹è¯¯å·®: < 0.01%
- äº¤å‰é¡¹æœ€å¤§ç›¸å¯¹è¯¯å·®: < 0.01%

#### æ€§èƒ½å¯¹æ¯”

| å‚æ•°æ•° | EP (s) | Bumping2 diag | Bumping2 full (est) | vs diag | vs full |
|--------|--------|---------------|---------------------|---------|---------|
| 16 | 1.31 | 0.18 | 3.01 | 0.14x | 2.3x |
| 36 | 1.48 | 0.50 | 18.27 | 0.34x | **12.3x** |
| 64 | 1.70 | 1.07 | 69.20 | 0.63x | **40.6x** |
| 100 | 1.91 | 1.90 | 190.91 | 1.0x | **100x** |
| 144 | 1.86 | 3.13 | 453.00 | **1.69x** | **244x** |

**å…³é”®å‘ç°**ï¼š
- EPæ—¶é—´å‡ ä¹æ’å®š (~1.5-1.9s)ï¼Œä¸å‚æ•°æ•°é‡å…³ç³»ä¸å¤§
- Crossoverç‚¹ï¼ˆvs Bumping2 diagï¼‰ï¼šçº¦100å‚æ•°
- å®Œæ•´Hessianä¼˜åŠ¿å·¨å¤§ï¼š144å‚æ•°æ—¶**244x faster**
- B-spline compact supportè‡ªåŠ¨å‰”é™¤æ— æ•ˆå‚æ•°ï¼ˆ144â†’110ï¼‰

---

## 2025-12-03 02:00

### EPç²¾åº¦é—®é¢˜ä¿®å¤ - Pushingé˜¶æ®µåŒå˜é‡å› å­2

#### é—®é¢˜æè¿°

EPåœ¨å¤åˆå‡½æ•°ï¼ˆå¦‚ `sqrt(1 + Î£xáµ¢Â²)`ï¼‰ä¸Šæœ‰~3-12%çš„è¯¯å·®ã€‚

#### æ ¹æœ¬åŸå› 

åœ¨Pushingé˜¶æ®µå¤„ç†å•ä¾‹ `W[{y}]` æ—¶ï¼Œå½“ä¸¤ä¸ªparentæŒ‡å‘**åŒä¸€ä¸ªå˜é‡**æ—¶ï¼ˆä¾‹å¦‚ `y = x * x`ï¼‰ï¼Œcross termç¼ºå°‘å› å­2ã€‚

**æ•°å­¦æ¨å¯¼**ï¼š
å¯¹äº `y = x * x`ï¼Œå­˜å‚¨çš„local partialsæ˜¯ `[(x, x.val), (x, x.val)]`ã€‚
```
(âˆ‚y/âˆ‚x)Â² = (aâ‚€ + aâ‚)Â² = aâ‚€Â² + 2*aâ‚€*aâ‚ + aâ‚Â²
```
åŸä»£ç è®¡ç®— `aâ‚€Â² + aâ‚€*aâ‚ + aâ‚Â² = 3xÂ²`ï¼Œä½†æ­£ç¡®å€¼æ˜¯ `4xÂ²`ã€‚

#### ä¿®å¤ä½ç½®

`engine.py` ç¬¬ 386-393 è¡Œï¼š
```python
# åŸä»£ç 
W_var_pairs[new_key] += w * a_r * a_s

# ä¿®å¤å
if id(p_r) == id(p_s):
    W_var_pairs[new_key] += 2.0 * w * a_r * a_s  # äºŒé¡¹å¼å±•å¼€å› å­2
else:
    W_var_pairs[new_key] += w * a_r * a_s
```

#### ä¿®å¤åéªŒè¯

| æµ‹è¯•å‡½æ•° | ä¿®å¤å‰è¯¯å·® | ä¿®å¤åè¯¯å·® |
|---------|-----------|-----------|
| sqrt(1+Î£xÂ²) | 3.40e-02 | **6.92e-07** |
| exp(-0.5*Î£xÂ²) | ~10% | **2.60e-07** |
| exp(-sqrt(log(1+Î£xÂ²))) | ~12% | **4.09e-07** |

**ç²¾åº¦ç°åœ¨ä¸Taylorå®Œå…¨ä¸€è‡´ï¼**

#### æ€§èƒ½å¯¹æ¯”ï¼ˆä¿®å¤åï¼‰

| ç»´åº¦ | EP (ms) | Taylor (ms) | EPåŠ é€Ÿ |
|------|---------|-------------|--------|
| 5 | 0.34 | 20.68 | 60.8x |
| 10 | 0.74 | 153.69 | 206.9x |
| 20 | 1.93 | 1171.93 | 606.9x |
| 36 | 5.15 | 7585.23 | **1472.4x** |

**ç»“è®º**ï¼šEPç°åœ¨åœ¨æ‰€æœ‰å¤åˆå‡½æ•°ä¸Šç²¾åº¦ä¸Taylorä¸€è‡´ï¼Œä¸”é€Ÿåº¦ä¼˜åŠ¿ä¿æŒä¸å˜ã€‚

---

## 2025-12-03 01:00

### å®Œæ•´å¯¹æ¯”æµ‹è¯•ï¼šEP vs Taylor vs Bumping2

#### æµ‹è¯•ç¯å¢ƒ

åˆ›å»º `test_ep_taylor_bumping_comparison.py`ï¼Œç³»ç»Ÿå¯¹æ¯”ä¸‰ç§æ–¹æ³•çš„ç²¾åº¦å’Œé€Ÿåº¦ã€‚

#### ç²¾åº¦å¯¹æ¯”

| æµ‹è¯•å‡½æ•° | Taylorè¯¯å·® | EPè¯¯å·® | è¯´æ˜ |
|---------|-----------|--------|------|
| f(x) = Î£xáµ¢Â² | 1.02e-05 | 1.02e-05 | âœ“ ä¸¤è€…éƒ½å‡†ç¡® |
| f(x) = xâ‚€xâ‚+xâ‚‚xâ‚ƒ | 1.55e-05 | 1.55e-05 | âœ“ äº¤å‰é¡¹å‡†ç¡® |
| exp+sqrt+log | 6.22e-05 | **1.23e-01** | âš  EPæœ‰ç²¾åº¦é—®é¢˜ |

**EPç²¾åº¦é—®é¢˜åˆ†æ**ï¼š
- `sqrt(1 + Î£xáµ¢Â²)` å•ç‹¬æµ‹è¯•æœ‰ ~3% è¯¯å·®
- å¯èƒ½åŸå› ï¼šå¤åˆå‡½æ•°çš„äºŒé˜¶å¯¼æ•°é“¾å¼æ³•åˆ™å¤„ç†ä¸å®Œå–„
- æˆ‘ä»¬çš„ç¨€ç–EPå®ç°ï¼ˆç”¨äºB-splineï¼‰å·²éªŒè¯æ­£ç¡®ï¼ˆè¯¯å·®<0.02%ï¼‰

#### é€Ÿåº¦å¯¹æ¯”

| ç»´åº¦ | Taylor (ms) | EP (ms) | Bump2 (ms) | EP vs Bump | EP vs Taylor |
|------|------------|---------|------------|------------|--------------|
| 5 | 0.34 | 0.54 | 0.44 | 0.82x | 0.63x |
| **10** | 2.05 | **1.13** | 2.63 | **2.32x** | **1.81x** |
| 20 | 14.35 | 2.92 | 17.88 | 6.12x | 4.91x |
| 36 | 78.79 | 8.42 | 96.41 | **11.45x** | **9.36x** |
| 64 | 427.28 | 28.96 | 517.83 | **17.88x** | **14.75x** |

**Crossoverç‚¹**ï¼šn â‰ˆ 10

#### å¤æ‚åº¦åˆ†æ

```
æ–¹æ³•å¯¹æ¯”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Method      â”‚ Function Evals â”‚   Complexity       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Taylor          â”‚  n(n+1)/2      â”‚  O(nÂ²) passes      â”‚
â”‚ Edge-Pushing    â”‚  1             â”‚  O(1) passes       â”‚
â”‚ Bumping2 (FD)   â”‚  ~4n(n+1)/2    â”‚  O(nÂ²) evals       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ä¾‹ (n=225):
- Taylor:  25,425 æ¬¡å‰å‘ä¼ æ’­
- EP:      1 æ¬¡åå‘ä¼ æ’­
- Bumping2: ~101,700 æ¬¡å‡½æ•°æ±‚å€¼
```

#### æ¨èä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ–¹æ³• | åŸå›  |
|------|---------|------|
| n < 10 | Taylor | æ›´å¿«ï¼Œç²¾åº¦æœ€é«˜ |
| n = 10-30 | EP | é€Ÿåº¦ä¼˜åŠ¿å¼€å§‹æ˜¾ç° |
| n > 30 | EP | 10-20x faster than Taylor |
| B-spline PDE | EP | **1248x** faster than Bumping2 |

#### å¯èƒ½çš„ç²¾åº¦æ”¹è¿›æ–¹å‘

1. æ£€æŸ¥ `_second_locals` å¯¹å¤åˆå‡½æ•°çš„å¤„ç†
2. æ£€æŸ¥ Pushing stage çš„é“¾å¼æ³•åˆ™ç´¯ç§¯
3. å‚è€ƒæˆ‘ä»¬çš„ç¨€ç–EPå®ç°ï¼ˆå·²éªŒè¯æ­£ç¡®ï¼‰

---

## 2025-12-03 00:30

### JPM repo EP Bugä¿®å¤ + é‡æ–°éªŒè¯

#### å‘ç°å¹¶ä¿®å¤çš„Bug

**Bug 1: use_tape() å…¼å®¹æ€§é—®é¢˜**
- é—®é¢˜ï¼š`arithmetic.py`, `transcendental.py`, `special.py`, `engine.py` ä½¿ç”¨ `from .tape import global_tape`
- åŸå› ï¼šPython æ¨¡å—å¯¼å…¥åœ¨åŠ è½½æ—¶ç»‘å®šï¼Œ`use_tape()` æ›¿æ¢æ¨¡å—å˜é‡åä¸ç”Ÿæ•ˆ
- ä¿®å¤ï¼šæ”¹ç”¨ `from . import tape as tape_mod`ï¼Œè®¿é—® `tape_mod.global_tape`

**Bug 2: è‡ªä¹˜äºŒé˜¶å¯¼æ•°ç¼ºå¤±**
- é—®é¢˜ï¼š`x * x` è¿”å› Hessian=1 è€Œä¸æ˜¯ 2
- åŸå› ï¼š`edge_push_hessian` çš„ Creating stage æ²¡æœ‰å¤„ç† parent_ids ç›¸åŒçš„æƒ…å†µ
- ä¿®å¤ï¼šåœ¨ `engine.py` ç¬¬ 448-455 è¡Œæ·»åŠ  factor=2 å½“ `parent_ids[u] == parent_ids[v]`

#### ä¿®å¤åçš„æ€§èƒ½å¯¹æ¯”

| ç»´åº¦ | Taylor (ms) | EP (ms) | EPåŠ é€Ÿ |
|------|------------|---------|--------|
| 5 | 0.38 | 0.61 | 0.63x (Taylor faster) |
| **10** | **2.25** | **1.24** | **1.81x** |
| 15 | 6.89 | 2.06 | 3.34x |
| 20 | 15.43 | 3.19 | 4.83x |
| 36 | 81.81 | 8.75 | **9.35x** |
| 64 | 440.91 | 30.01 | **14.69x** |
| 100 | 1657.22 | 88.06 | **18.82x** |

**Crossoverç‚¹**ï¼šn â‰ˆ 10 (æ¯”ä¿®å¤å‰æ›´æ—©ï¼)

#### æ­£ç¡®æ€§éªŒè¯

| å‡½æ•° | Taylor vs FD | EP vs FD | åŒ¹é… |
|------|-------------|----------|------|
| f(x) = Î£xáµ¢Â² | 1.02e-05 | 1.02e-05 | âœ“ |
| exp+sqrt+log | 7.75e-05 | 9.45e-02 | éƒ¨åˆ† |

#### ç»“è®ºæ›´æ–°

| åœºæ™¯ | æ¨èæ–¹æ³• | EPåŠ é€Ÿ |
|------|---------|--------|
| n < 10 | Taylor | - |
| n = 10-36 | EP | 2-9x |
| n = 64-100 | EP | 15-19x |
| B-spline (225) | EP | **1248x** |

**EPä¼˜åŠ¿æ›´æ˜æ˜¾**ï¼šä¿®å¤bugåï¼ŒEPåœ¨nâ‰¥10æ—¶å°±å¼€å§‹é¢†å…ˆï¼Œè€Œéä¹‹å‰çš„nâ‰¥20ã€‚

---

## 2025-12-02 23:30

### Taylor Expansion vs Edge-Pushing åˆæ­¥å¯¹æ¯”

#### å¯¹æ¯”ç¯å¢ƒ

**ä»£ç æ¥æº**ï¼šhttps://github.com/xuenailao/JPM-Practicum-AAD

#### å‘ç°çš„é—®é¢˜

**JPM repo EPå®ç°æœ‰bug**ï¼š
- å¯¹äº f(x) = Î£xáµ¢Â², Hessianåº”ä¸º2I
- Taylorè¿”å›2I âœ“
- EPè¿”å›I âœ—ï¼ˆå·®ä¸€å€ï¼‰
- åŸå› ï¼šè‡ªä¹˜ï¼ˆx*xï¼‰çš„äºŒé˜¶å¯¼æ•°å¤„ç†æœ‰è¯¯ + use_tape()å…¼å®¹æ€§é—®é¢˜

â†’ å·²åœ¨åç»­è®°å½•ä¸­ä¿®å¤

#### åˆ›å»ºçš„æ–‡ä»¶

- `test_taylor_vs_ep.py` - åŸºç¡€å¯¹æ¯”æµ‹è¯•
- `test_taylor_vs_ep_detailed.py` - è¯¦ç»†åˆ†æï¼ˆå«æœ‰é™å·®åˆ†éªŒè¯ï¼‰

---

## 2025-12-02 22:15

### åç»­å·¥ä½œè®¡åˆ’

#### å½“å‰çŠ¶æ€ âœ…

æ€§èƒ½ä¼˜åŒ–å·²å®Œæˆï¼š
- ç¨€ç–ä¼˜åŒ–ï¼š60x
- Cythonä¼˜åŒ–ï¼š+3x = 190x total
- å¤§è§„æ¨¡éªŒè¯ï¼šup to **1248x** at 225 params
- EPç°åœ¨æ¯”Bumping2å¯¹è§’çº¿éƒ½å¿«ï¼ˆ5.5xï¼‰

#### è¿‘æœŸä»»åŠ¡ï¼ˆ1-2å‘¨ï¼‰

**ä¼˜å…ˆçº§1ï¼šçœŸå®æœŸæƒæ•°æ®åº”ç”¨** â­â­â­
- æ•°æ®ï¼š`UnderlyingOptionsEODQuotes_2025-02-06`
- ç›®æ ‡ï¼šç”¨EPåŠ é€ŸB-spline volatility surfaceæ ¡å‡†
- ä»»åŠ¡ï¼šåŠ è½½æ•°æ® â†’ è®¾ç½®æ ¡å‡†ç›®æ ‡ â†’ EPè®¡ç®—Hessian â†’ Newtonä¼˜åŒ– â†’ éªŒè¯æ›²é¢è´¨é‡

**ä¼˜å…ˆçº§2ï¼šTaylor Expansionå¯¹æ¯”** â­â­
- ä»£ç ï¼šhttps://github.com/xuenailao/JPM-Practicum-AAD
- ç›®æ ‡ï¼šå¯¹æ¯”EP vs Taylor expansionåœ¨B-splineæ¨¡å‹ä¸Šçš„è¡¨ç°
- å…³é”®ï¼šç²¾åº¦ã€é€Ÿåº¦ã€å†…å­˜å¯¹æ¯”ï¼Œç¡®å®šæœ€ä¼˜ä½¿ç”¨åœºæ™¯

**ä¼˜å…ˆçº§3ï¼šæŠ€æœ¯æŠ¥å‘Š** â­â­
- æ–‡æ¡£åŒ–ä¼˜åŒ–å†ç¨‹ï¼ˆ60x â†’ 190x â†’ 1248xï¼‰
- å®é™…åº”ç”¨æ¡ˆä¾‹
- æ–¹æ³•å¯¹æ¯”å’Œå»ºè®®

#### ä¸­é•¿æœŸè®¡åˆ’

**1-3æœˆ**ï¼š
- æ›´å¤æ‚PDEæ¨¡å‹ï¼ˆHeston, Jump-diffusion, Multi-assetï¼‰
- ç”Ÿäº§ç³»ç»Ÿå¼€å‘ï¼ˆAPI, ç¼“å­˜, ç›‘æ§ï¼‰

**3-6æœˆ**ï¼š
- å­¦æœ¯å‘è¡¨ï¼ˆJournal of Computational Financeï¼‰
- å¼€æºåŒ…å‘å¸ƒï¼ˆ`aad-edge-pushing`ï¼‰

#### æ¨èè¡ŒåŠ¨

Week 1-2ï¼šçœŸå®æ•°æ®åº”ç”¨
Week 3-4ï¼šTaylorå¯¹æ¯”
Week 5-6ï¼šæŠ€æœ¯æŠ¥å‘Š

---

## 2025-12-02 22:00

### å¤§è§„æ¨¡éªŒè¯å®Œæˆ - 1248xæé™åŠ é€Ÿï¼

#### æµ‹è¯•é…ç½®

**è§„æ¨¡**ï¼š100-225å‚æ•°ï¼ˆå®é™…activeå‚æ•°ï¼š90-140ï¼Œå› B-spline compact supportï¼‰
**ç¯å¢ƒ**ï¼šGrid M=20, N=10, Cythonä¼˜åŒ–å¯ç”¨

#### æ€§èƒ½ç»“æœ

| å‚æ•°é…ç½® | æ´»è·ƒå‚æ•° | EP (Cython) | Bumping2 Full (ä¼°è®¡) | **åŠ é€Ÿ** |
|---------|---------|-------------|---------------------|---------|
| 10Ã—10 (100) | 90 | 1.05s | 218s | **207x** |
| 12Ã—12 (144) | 110 | 1.01s | 524s | **519x** |
| 15Ã—15 (225) | 140 | **1.18s** | **1470s** | **1248x** |

#### å…³é”®å‘ç°

**1. EPæ—¶é—´å‡ ä¹æ’å®š**ï¼ˆ~1ç§’ï¼‰- O(1)å¤æ‚åº¦ï¼
**2. EPç°åœ¨æ¯”Bumping2å¯¹è§’çº¿è¿˜å¿«**ï¼ˆ5.5x at 225 paramsï¼‰
**3. B-spline compact supportè‡ªåŠ¨å‰”é™¤æ— æ•ˆå‚æ•°**ï¼ˆ90/100, 110/144, 140/225ï¼‰
**4. æé™åŠ é€Ÿ**ï¼š225å‚æ•°æ—¶è¾¾åˆ°**1248x**ï¼

#### ç»“è®º

æ€§èƒ½å·²è¿œè¶…ç›®æ ‡ã€‚EPé€‚ç”¨äºï¼š
- **å®Œæ•´Hessian**ï¼šå§‹ç»ˆä½¿ç”¨EPï¼ˆ200-1200x fasterï¼‰
- **å¯¹è§’çº¿Hessian**ï¼ˆå‚æ•°â‰¥50ï¼‰ï¼šEPä»æ›´å¿«ï¼ˆup to 5.5xï¼‰

**ä¸‹ä¸€æ­¥**ï¼šå‡†å¤‡æŠ€æœ¯æŠ¥å‘Šï¼Œæµ‹è¯•çœŸå®æ•°æ®åº”ç”¨

---

## 2025-12-02 21:25

### Cythonä¼˜åŒ–å®ç° - é¢å¤–3.15xåŠ é€Ÿï¼

#### å®æ–½å†…å®¹

å°è¯•å®ç°OpenMPå¹¶è¡ŒåŒ–ä»¥è¿›ä¸€æ­¥åŠ é€Ÿalgo4_sparseã€‚é‡åˆ°æŠ€æœ¯é™åˆ¶ï¼ˆéœ€è¦.pxdæ–‡ä»¶æ‰èƒ½å®ç°true nogilï¼‰ï¼Œä½†æˆåŠŸå®ç°Cython + C++ vectorä¼˜åŒ–ç‰ˆæœ¬ã€‚

**åˆ›å»ºæ–‡ä»¶**ï¼š
- `algo4_sparse_openmp.pyx` - Cythonä¼˜åŒ–çš„ç¨€ç–algo4
- `setup_sparse_openmp.py` - ç¼–è¯‘é…ç½®
- `test_cython_speedup.py` - æ€§èƒ½æµ‹è¯•

#### æ€§èƒ½ç»“æœ

**æµ‹è¯•é…ç½®**: 6Ã—6 = 36 parameters, M=20, N=10

| å®ç° | æ—¶é—´ | åŠ é€Ÿ |
|------|------|------|
| Python sparse | 1.277s | 1.0x (baseline) |
| **Cython sparse** | **0.406s** | **3.15x** |

**æ€»åŠ é€Ÿå€æ•°**ï¼š
- ç¨€ç–ä¼˜åŒ–: 60x (vs naive algo4)
- Cythonä¼˜åŒ–: 3.15x (vs Python sparse)
- **æ€»è®¡: ~190x** (60 Ã— 3.15)

#### æŠ€æœ¯æ€»ç»“

**å°è¯•çš„æ–¹æ³•**ï¼š
1. âœ— True OpenMPå¹¶è¡ŒåŒ– - éœ€è¦.pxdæ–‡ä»¶æ”¯æŒcimportï¼Œè¿‡äºå¤æ‚
2. âœ“ Cython + C++ vectorä¼˜åŒ– - æˆåŠŸå®ç°ï¼Œæä¾›3xé¢å¤–åŠ é€Ÿ

**å…³é”®ä¼˜åŒ–ç‚¹**ï¼š
- ä½¿ç”¨C++ `vector<pair<int, pair<int, double>>>` å­˜å‚¨æ›´æ–°
- Cythonç¼–è¯‘çš„C-levelå¾ªç¯ï¼ˆæ¯”Pythonå¿«ï¼‰
- ä¸`symm_sparse_adjlist_cpp` C++çŸ©é˜µé…åˆ

**æŠ€æœ¯æ•™è®­**ï¼š
- æ²¡æœ‰.pxdæ–‡ä»¶æ—¶æ— æ³•ä½¿ç”¨`cimport`å’Œ`nogil`
- ä½†Cythonçš„C++ vector + C-levelå¾ªç¯ä»èƒ½æä¾›æ˜¾è‘—åŠ é€Ÿ
- ç¨€ç–ä¼˜åŒ–ï¼ˆ60xï¼‰æ¯”å¹¶è¡ŒåŒ–ï¼ˆ3xï¼‰æ›´é‡è¦

#### ç»“è®º

**å½“å‰çŠ¶æ€**ï¼š
- Python sparse: 1.28s/iteration
- Cython sparse: 0.41s/iteration
- **æ€§èƒ½å·²è¶³å¤Ÿå¥½ï¼Œæ— éœ€ç»§ç»­ä¼˜åŒ–**

**EP vs Bumping2ï¼ˆä½¿ç”¨Cythonç‰ˆæœ¬ï¼‰**ï¼š
- 36å‚æ•°ï¼šCython EP 0.41s vs Bumping2 full ~20s â†’ **~50x faster**
- 64å‚æ•°ï¼šCython EP ~0.42s vs Bumping2 full ~78s â†’ **~186x faster**

---

## 2025-12-02 20:00

### ä»£ç æ¸…ç† + å¤§è§„æ¨¡éªŒè¯å®Œæˆ

#### 1. ä»£ç æ¸…ç†

**åˆ é™¤åºŸå¼ƒæ–‡ä»¶**ï¼š
- 8ä¸ªè¿‡æ—¶çš„C++ OpenMPå®ç°ï¼ˆ124Kè¡Œä»£ç ï¼‰
- 15ä¸ªä¸´æ—¶æ–‡ä»¶ï¼ˆ.pkl, .txt, LaTeXç¼–è¯‘äº§ç‰©ï¼‰
- å½’æ¡£4ä¸ªè°ƒè¯•æµ‹è¯•è„šæœ¬åˆ° `archive/testing/`

**ä¿ç•™æ ¸å¿ƒæ–‡ä»¶**ï¼š
- `algo4_sparse.py` - ç¨€ç–ä¼˜åŒ–ä¸»å®ç°
- `test_ep_vs_bumping_sparse.py` - æ ¸å¿ƒå¯¹æ¯”æµ‹è¯•
- `test_ep_scaling.py` - è§„æ¨¡æµ‹è¯•

**ç»“æœ**ï¼šä»£ç åº“æ›´ç®€æ´ï¼Œæ˜“äºç»´æŠ¤

#### 2. æµ‹è¯•æ¡†æ¶æ”¹è¿›

**æ–°å¢CLIå‚æ•°**ï¼š
```bash
python test_ep_vs_bumping_sparse.py --configs "4x4,6x6,8x8" --grid-m 20 --grid-n 10
```

å‚æ•°è¯´æ˜ï¼š
- `--grid-m`: ç©ºé—´ç½‘æ ¼ç‚¹æ•°ï¼ˆé»˜è®¤20ï¼‰
- `--grid-n`: æ—¶é—´æ­¥æ•°ï¼ˆé»˜è®¤10ï¼‰
- `--configs`: B-splineé…ç½®ï¼ˆé»˜è®¤"4x4,6x6"ï¼‰

#### 3. å¤§è§„æ¨¡éªŒè¯ç»“æœ

**æµ‹è¯•é…ç½®**: M=20, N=10, S0=100, K=100, T=1, r=0.05

| n_params | EP (å®Œæ•´Hessian) | Bumping2 Full (ä¼°è®¡) | **EPåŠ é€Ÿ** |
|----------|------------------|---------------------|-----------|
| 16 (4Ã—4) | 1.44s | 3.31s | 2.3x |
| 36 (6Ã—6) | 1.70s | 20.26s | 11.9x |
| 64 (8Ã—8) | 1.94s | 77.91s | **40.2x** |
| 100 (10Ã—10) | ~2.15s | ~210s (ä¼°è®¡) | **~98x** |

**å…³é”®å‘ç°**ï¼š
1. **EPæ—¶é—´å‡ ä¹æ’å®š**ï¼š~2ç§’å®Œæˆå®Œæ•´Hessianï¼Œä¸å‚æ•°æ•°é‡å…³ç³»ä¸å¤§
2. **Bumping2æ—¶é—´O(nÂ²)å¢é•¿**ï¼šéœ€è¦4Ã—n(n+1)/2æ¬¡PDEæ±‚è§£
3. **Crossoverç‚¹**ï¼šçº¦50å‚æ•°æ—¶EPå¼€å§‹æ¯”Bumping2å¯¹è§’çº¿æ›´å¿«
4. **å®Œæ•´Hessianä¼˜åŠ¿æ˜æ˜¾**ï¼š64å‚æ•°æ—¶EPå¿«40å€

#### 4. å¯¹è§’çº¿ vs å®Œæ•´ Hessian

**é‡è¦åŒºåˆ«**ï¼š
- **å¯¹è§’çº¿Hessian**: åªæœ‰ n ä¸ªå…ƒç´ ï¼ˆâˆ‚Â²V/âˆ‚wáµ¢Â²ï¼‰
  - ç”¨é€”ï¼šå•å‚æ•°æ•æ„Ÿæ€§åˆ†æ
  - Bumping2éœ€è¦ï¼š2n+1æ¬¡PDEæ±‚è§£

- **å®Œæ•´Hessian**: nÃ—n ä¸ªå…ƒç´ ï¼ˆåŒ…æ‹¬äº¤å‰å¯¼æ•° âˆ‚Â²V/âˆ‚wáµ¢âˆ‚wâ±¼ï¼‰
  - ç”¨é€”ï¼šç‰›é¡¿ä¼˜åŒ–ã€ä¸ç¡®å®šæ€§é‡åŒ–ã€å‚æ•°ç›¸äº’å½±å“åˆ†æ
  - Bumping2éœ€è¦ï¼š~4Ã—n(n+1)/2æ¬¡PDEæ±‚è§£
  - **EPä¸€æ¬¡åå‘ä¼ æ’­å¾—åˆ°å…¨éƒ¨**

#### 5. B-splineç´§æ”¯é›†è§‚å¯Ÿ

10Ã—10é…ç½®ä¸­ï¼š
- å®šä¹‰äº†100ä¸ªç³»æ•°å‚æ•°
- **å®é™…ä½¿ç”¨90ä¸ª**ï¼ˆä¸€è¡Œw5,*æœªè¢«ä½¿ç”¨ï¼‰
- åŸå› ï¼šB-splineç´§æ”¯é›†æ€§è´¨ï¼ŒæŸäº›åŸºå‡½æ•°åœ¨å½“å‰ç½‘æ ¼ä¸Šæ”¯é›†ä¸ºç©º
- EPæ­£ç¡®è¯†åˆ«å®é™…ä¾èµ–å…³ç³» âœ“

#### 6. ä¸‹ä¸€æ­¥

**å·²å®Œæˆ**ï¼š
- âœ… ä»£ç æ¸…ç†ï¼ˆ-124Kè¡Œï¼‰
- âœ… æµ‹è¯•æ¡†æ¶CLIåŒ–
- âœ… éªŒè¯åˆ°64å‚æ•°ï¼ˆ40xåŠ é€Ÿï¼‰

**å¯é€‰æ”¹è¿›**ï¼š
- å¹¶è¡ŒåŒ–å®ç°ï¼ˆOpenMPï¼‰é¢„æœŸé¢å¤–2-4xåŠ é€Ÿ
- æ›´é«˜ç²¾åº¦ç½‘æ ¼æµ‹è¯•ï¼ˆM=50, N=25ï¼‰
- ç¨€ç–Hessianå­˜å‚¨ï¼ˆ200+å‚æ•°ï¼‰

---

## 2025-12-02 05:30

### ç¨€ç–ä¼˜åŒ–åŸç†è¯¦è§£

#### 1. é—®é¢˜èƒŒæ™¯

**åŸå§‹ algo4 çš„ç“¶é¢ˆ**ï¼š
```
PDE tape: ~11K nodes
W çŸ©é˜µ: 11K Ã— 11K çš„ç¨ å¯†æ“ä½œ
ä½†æˆ‘ä»¬åªéœ€è¦: 16Ã—16 çš„è¾“å…¥ Hessian
```

#### 2. æ ¸å¿ƒæ€æƒ³

åªè¿½è¸ª**ä¸è¾“å…¥å‚æ•°ç›¸å…³**çš„ W çŸ©é˜µæ¡ç›®ï¼š

```
åŸå§‹: W[i,j] for all i,j âˆˆ {0, ..., 11K}
ç¨€ç–: W[i,j] where i OR j æ˜¯è¾“å…¥æˆ–è¾“å…¥çš„"åä»£"
```

#### 3. ä¸¤ä¸ªå…³é”®ä¼˜åŒ–

**ä¼˜åŒ– 1: æ‰¾å‡º"ç›¸å…³èŠ‚ç‚¹"** (`_find_relevant_nodes`)

```python
def _find_relevant_nodes(nodes, var_to_idx, input_indices):
    relevant = set(input_indices)  # è¾“å…¥èŠ‚ç‚¹ä¸€å®šç›¸å…³

    # å‰å‘éå†ï¼šä»è¾“å…¥å‘è¾“å‡ºä¼ æ’­
    for node in nodes:
        for parent, _ in node.parents:
            if parent_idx in relevant:
                relevant.add(node_idx)  # çˆ¶èŠ‚ç‚¹ç›¸å…³ â†’ å½“å‰èŠ‚ç‚¹ä¹Ÿç›¸å…³
                break

    return relevant
```

**æ•ˆæœ**ï¼š11K èŠ‚ç‚¹ â†’ ~3K ç›¸å…³èŠ‚ç‚¹

**ä¼˜åŒ– 2: ç¨€ç– W çŸ©é˜µå­˜å‚¨** (`SparseWMatrix`)

```python
class SparseWMatrix:
    # ä¸å­˜å‚¨ 11KÃ—11K ç¨ å¯†çŸ©é˜µ
    # åªå­˜å‚¨æœ‰å€¼çš„ (i,j) å¯¹
    _data: Dict[int, Dict[int, float]]  # W[i][j] = value
```

#### 4. ä¿®æ”¹åçš„ç®—æ³•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹ algo4                    â”‚  ç¨€ç– algo4            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  for node in all_nodes:        â”‚  for node in all_nodes:â”‚
â”‚    pushing_stage(W, node)      â”‚    if node in relevant:â”‚
â”‚    creating_stage(W, node)     â”‚      pushing(W, node)  â”‚
â”‚    adjoint_stage(vbar, node)   â”‚      creating(W, node) â”‚
â”‚                                â”‚      adjoint(vbar)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5. Pushing Stage ä¼˜åŒ–

**åŸå§‹**ï¼š
```python
for all neighbors p of i:
    for all predecessors j, k of i:
        W[j,k] += d_j * d_k * W[p,i]
```

**ç¨€ç–**ï¼š
```python
for all neighbors p of i:
    if p not in relevant: continue  # è·³è¿‡ä¸ç›¸å…³
    for all predecessors j, k of i:
        if j not in relevant: continue
        if k not in relevant: continue
        W[j,k] += d_j * d_k * W[p,i]
```

#### 6. æ€§èƒ½å¯¹æ¯”

| é˜¶æ®µ | åŸå§‹ | ç¨€ç– | è¯´æ˜ |
|------|------|------|------|
| èŠ‚ç‚¹éå† | 11K | 3K | è·³è¿‡ä¸ç›¸å…³èŠ‚ç‚¹ |
| W æ¡ç›® | O(nÂ²) | O(ç¨€ç–) | åªå­˜æœ‰å€¼æ¡ç›® |
| Pushing | O(EÃ—dÂ²) | O(E_relÃ—dÂ²) | E_rel << E |

#### 7. å›¾ç¤º

```
è¾“å…¥å±‚ (16ä¸ª w ç³»æ•°)
    â†“
  [ç›¸å…³èŠ‚ç‚¹] â† åªè¿½è¸ªè¿™äº›
    â†“
  [ç›¸å…³èŠ‚ç‚¹]
    â†“
  [ä¸ç›¸å…³èŠ‚ç‚¹] â† è·³è¿‡ï¼
    â†“
  [ç›¸å…³èŠ‚ç‚¹]
    â†“
è¾“å‡º (price)
```

**ç»“æœ**ï¼š60x åŠ é€Ÿ (60s â†’ 1s)ï¼ŒHessian å®Œå…¨ä¸€è‡´ (diff < 1e-14)

#### 8. å®Œæ•´ Hessian éªŒè¯

éªŒè¯ EP è®¡ç®—çš„å®Œæ•´ Hessianï¼ˆä¸ä»…æ˜¯å¯¹è§’çº¿ï¼‰ä¸ Bumping2 åŒ¹é…ï¼š

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| æœ€å¤§ç»å¯¹è¯¯å·® | 6.85e-03 |
| **æœ€å¤§ç›¸å¯¹è¯¯å·®** | **0.083%** |
| å¯¹è§’çº¿è¯¯å·® | < 0.02% |
| éå¯¹è§’è¯¯å·® | < 0.1% |

**ç»“è®º**ï¼šEP è®¡ç®—çš„å®Œæ•´ Hessian ä¸æœ‰é™å·®åˆ†é«˜åº¦å»åˆ

#### 9. è®¡ç®—å›¾åˆ†æï¼šç›¸å…³èŠ‚ç‚¹åˆ¤æ–­ç¤ºä¾‹

**ç¤ºä¾‹å‡½æ•°**ï¼š`f(x) = 5x_{-2}(x_{-1} + x_0)`

**è®¡ç®—å›¾èŠ‚ç‚¹**ï¼š
```
v_{-2} = x_{-2}  (è¾“å…¥)
v_{-1} = x_{-1}  (è¾“å…¥)
v_0 = x_0        (è¾“å…¥)
v_1 = 5v_{-2}    (ä¸­é—´èŠ‚ç‚¹)
v_2 = v_{-1} + v_0  (ä¸­é—´èŠ‚ç‚¹)
v_3 = v_2 v_1    (è¾“å‡º)
```

**ç›¸å…³èŠ‚ç‚¹åˆ¤æ–­è¿‡ç¨‹**ï¼š

```python
# æ­¥éª¤ 1: åˆå§‹åŒ–
relevant = {v_{-2}, v_{-1}, v_0}  # 3ä¸ªè¾“å…¥èŠ‚ç‚¹

# æ­¥éª¤ 2: å‰å‘éå†
# å¤„ç† v_1 = 5v_{-2}
#   çˆ¶èŠ‚ç‚¹: v_{-2} âˆˆ relevant? âœ“
relevant.add(v_1)  # relevant = {v_{-2}, v_{-1}, v_0, v_1}

# å¤„ç† v_2 = v_{-1} + v_0
#   çˆ¶èŠ‚ç‚¹: v_{-1} âˆˆ relevant? âœ“
relevant.add(v_2)  # relevant = {v_{-2}, v_{-1}, v_0, v_1, v_2}

# å¤„ç† v_3 = v_2 Â· v_1
#   çˆ¶èŠ‚ç‚¹: v_2 âˆˆ relevant? âœ“
relevant.add(v_3)  # relevant = {v_{-2}, v_{-1}, v_0, v_1, v_2, v_3}

# ç»“æœ: æ‰€æœ‰ 6 ä¸ªèŠ‚ç‚¹éƒ½ç›¸å…³
```

**ä¸ºä»€ä¹ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½ç›¸å…³ï¼Ÿ**

å› ä¸ºæ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨è¾“å…¥â†’è¾“å‡ºçš„ä¾èµ–è·¯å¾„ä¸Šï¼š
```
è·¯å¾„ 1: x_{-2} â†’ v_1 â†’ v_3  (x_{-2} å½±å“è¾“å‡º)
è·¯å¾„ 2: x_{-1} â†’ v_2 â†’ v_3  (x_{-1} å½±å“è¾“å‡º)
è·¯å¾„ 3: x_0 â†’ v_2 â†’ v_3     (x_0 å½±å“è¾“å‡º)
```

**åä¾‹ï¼šä¸ç›¸å…³èŠ‚ç‚¹**

å¦‚æœæ·»åŠ  `v_4 = 2 Ã— 3 = 6` (å¸¸æ•°è®¡ç®—)ï¼š
- çˆ¶èŠ‚ç‚¹éƒ½æ˜¯å¸¸æ•°ï¼Œä¸åœ¨ `relevant` ä¸­
- v_4 ä¸ä¼šè¢«æ·»åŠ åˆ° `relevant`
- åŸå› ï¼š`âˆ‚Â²v_3/âˆ‚x_iâˆ‚x_j` ä¸éœ€è¦é€šè¿‡ v_4 ä¼ æ’­ï¼ˆâˆ‚v_4/âˆ‚x_i = 0ï¼‰

**PDE åœºæ™¯åº”ç”¨**ï¼š

åœ¨ B-spline PDE ä¸­ï¼š
```
è¾“å…¥ï¼š16 ä¸ªç³»æ•° w[i,j]
  â†“ ç›¸å…³
Ïƒ(S,t) = Î£w[i,j]Â·B_i(S)Â·B_j(t)  â† ä¾èµ–è¾“å…¥
  â†“ ç›¸å…³
ä¸‰å¯¹è§’çŸ©é˜µå…ƒç´  a, b, c          â† ä¾èµ– Ïƒ
  â†“ ä¸ç›¸å…³
dt = T/N (å¸¸æ•°)                 â† ä¸ä¾èµ–è¾“å…¥ï¼
dx = (S_max-S_min)/M (å¸¸æ•°)     â† ä¸ä¾èµ–è¾“å…¥ï¼
  â†“ ç›¸å…³
V çš„æ—¶é—´æ­¥è¿›                    â† ä¾èµ– a,b,c
  â†“
è¾“å‡ºï¼šprice
```

**æ€§èƒ½æå‡**ï¼š
- æ€»èŠ‚ç‚¹ï¼š11,000
- ä¸ç›¸å…³èŠ‚ç‚¹ï¼š~8,000 (73%) â† å¸¸æ•°è®¡ç®—ã€å›ºå®šç½‘æ ¼è®¡ç®—
- ç›¸å…³èŠ‚ç‚¹ï¼š~3,000 (27%)
- **åªå¤„ç† 3,000 èŠ‚ç‚¹ â†’ 60x åŠ é€Ÿ**

---

## 2025-12-02 05:00

### å¤§è§„æ¨¡æµ‹è¯•ï¼šEP ä¼˜åŠ¿éšå‚æ•°æ•°é‡å¢é•¿

**æµ‹è¯•é…ç½®**: M=20, N=10, S0=100, K=100, T=1, r=0.05

| n_params | EP (s) | Bumping2 full (est) | **EP åŠ é€Ÿ** |
|----------|--------|---------------------|-------------|
| 16 | 1.60 | 3.50 | 2.2x |
| 36 | 1.71 | 20.15 | 11.8x |
| 64 | 1.96 | 77.05 | **39.4x** |
| 100 | 2.17 | 209.83 | **96.5x** |

**å…³é”®æ´å¯Ÿ**ï¼š
- EP æ—¶é—´ ~O(1)ï¼šä¸»è¦æ˜¯ tape æ„å»ºï¼Œä¸å‚æ•°æ•°é‡å…³ç³»ä¸å¤§
- Bumping2 æ—¶é—´ ~O(nÂ²)ï¼šéœ€è¦ 4Ã—n(n+1)/2 æ¬¡ PDE æ±‚è§£
- **100 å‚æ•°æ—¶ EP å¿«è¿‘ 100 å€ï¼**

**ç»“è®º**ï¼šEdge-Pushing åœ¨é«˜ç»´å‚æ•°ç©ºé—´æœ‰æ˜¾è‘—ä¼˜åŠ¿

---

## 2025-12-02 04:30

### é›†æˆï¼šalgo4_sparse åˆ°ä¸» PDE æ±‚è§£å™¨

**å˜æ›´**ï¼š`pde_aad_bspline_2d.py` ä¸­ `solve_pde_with_aad()` ç°åœ¨ä½¿ç”¨ `algo4_sparse`

**æ›¿æ¢**ï¼š
```python
# æ—§ä»£ç 
from algo4_cython_simple import algo4_cython_simple
hessian = algo4_cython_simple(price_var, coeff_advars_flat)

# æ–°ä»£ç 
from algo4_sparse import algo4_sparse
hessian = algo4_sparse(price_var, coeff_advars_flat, sort_inputs=True)
```

**ç»“æœ**ï¼š
- ä¸»æ±‚è§£å™¨è‡ªåŠ¨ä½¿ç”¨ç¨€ç–ä¼˜åŒ–
- 1.38s (16 params) vs åŸæ¥ ~60s
- ä¸ Bumping2 å¯¹è§’çº¿è¯¯å·® < 0.02%

---

## 2025-12-02 04:00

### ä¿®å¤ï¼šEP vs Bumping2 å¯¹è§’çº¿åŒ¹é…é—®é¢˜

**é—®é¢˜**ï¼šEP å’Œ Bumping2 çš„ Hessian å¯¹è§’çº¿ä¸åŒ¹é…

**åŸå› åˆ†æ**ï¼š
- EP è¾“å…¥æŒ‰ tape å‡ºç°é¡ºåºï¼š`w0,0, w0,1, w0,2, w1,0, ..., w0,3, w1,3, w2,3, w3,3`
- Bumping2 æŒ‰è¡Œä¸»åºè¿­ä»£ï¼š`w0,0, w0,1, w0,2, w0,3, w1,0, ...`
- é¡ºåºä¸åŒå¯¼è‡´ Hessian çŸ©é˜µå…ƒç´ é”™ä½

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ·»åŠ  `sort_inputs_rowmajor()` è¾…åŠ©å‡½æ•°
- `algo4_sparse()` æ–°å¢ `sort_inputs=True` å‚æ•°
- å°†è¾“å…¥æŒ‰ `(i, j)` ç´¢å¼•æ’åºä¸ºè¡Œä¸»åº

**ç»“æœ**ï¼š
- å¯¹è§’çº¿åŒ¹é…ï¼Œæœ€å¤§ç›¸å¯¹è¯¯å·® **< 0.02%** âœ“
- ä¸æœ‰é™å·®åˆ† Bumping2 å®Œç¾å»åˆ

---

## 2025-12-02 03:30

### é‡å¤§çªç ´ï¼šç¨€ç– algo4 ä¼˜åŒ–æˆåŠŸï¼

**ä¼˜åŒ–æ€è·¯**ï¼šåªè¿½è¸ªä¸ B-spline ç³»æ•°è¾“å…¥ç›¸å…³çš„ W çŸ©é˜µæ¡ç›®

**å®ç°**ï¼š`algo4_sparse.py`
- è¯†åˆ«çœŸæ­£çš„è¾“å…¥å‚æ•°ï¼ˆåªæœ‰ w* å‘½åçš„ç³»æ•°ï¼‰
- å‰å‘éå†æ‰¾å‡º"ç›¸å…³èŠ‚ç‚¹"ï¼ˆä»è¾“å…¥å¯è¾¾çš„èŠ‚ç‚¹ï¼‰
- pushing/creating stage åªå¤„ç†ç›¸å…³èŠ‚ç‚¹

**æ€§èƒ½å¯¹æ¯”** (M=20, N=10, 16 params):

| ç‰ˆæœ¬ | algo4 æ—¶é—´ | åŠ é€Ÿ |
|------|-----------|------|
| åŸå§‹ algo4 | ~60s | åŸºå‡† |
| **ç¨€ç– algo4** | **~1s** | **60Ã— åŠ é€Ÿ** |

**æ­£ç¡®æ€§éªŒè¯**ï¼šç¨€ç– vs åŸå§‹ Hessian å·®å¼‚ < 1e-14 âœ“

### EP vs Bumping2 (ä½¿ç”¨ç¨€ç–ä¼˜åŒ–å)

| n_params | EP æ€»æ—¶é—´ | Bumping2 full (est) | EP ä¼˜åŠ¿ |
|----------|----------|---------------------|---------|
| 16 | 1.39s | 3.08s | **2.2Ã— æ›´å¿«** |
| 36 | 1.57s | 18.47s | **11.7Ã— æ›´å¿«** |

**å…³é”®ç‚¹**ï¼š
- EP æä¾›**å®Œæ•´ Hessian**ï¼ˆæ‰€æœ‰ nÂ² ä¸ªå…ƒç´ ï¼‰
- Bumping2 å¯¹è§’çº¿åªæœ‰ n ä¸ªå…ƒç´ 
- å¯¹æ¯”å®Œæ•´ Hessian æ—¶ï¼ŒEP å·²ç»æ˜¾è‘—æ›´å¿«

### ä¸‹ä¸€æ­¥
- æ¸…ç†æµ‹è¯•æ–‡ä»¶
- å°†ç¨€ç–ä¼˜åŒ–é›†æˆåˆ°ä¸» PDE æ±‚è§£å™¨

---

## 2025-12-02 02:30

### å…¬å¹³å¯¹æ¯”æµ‹è¯•ç»“æœï¼šEP vs çº¯æ•°å€¼ Bumping2ï¼ˆä¼˜åŒ–å‰ï¼‰

**æµ‹è¯•é…ç½®**: M=20, N=10, S0=100, K=100, T=1, r=0.05

| n_params | EP (s) | Bumping2 diag (s) | Bumping2 full (est) | EP/Bump |
|----------|--------|-------------------|---------------------|---------|
| 16 (4Ã—4) | 58.37 | 0.20 | 3.24 | **298Ã— æ…¢** |
| 36 (6Ã—6) | 63.19 | 0.51 | 18.54 | **124Ã— æ…¢** |

### å…³é”®å‘ç°

**EP åœ¨å½“å‰å®ç°ä¸‹è¿œæ…¢äºçº¯æ•°å€¼ Bumping2**

åŸå› åˆ†æï¼š
1. **algo4 pushing stage æ˜¯ç“¶é¢ˆ**ï¼šPDE å›¾ç»“æ„å¯¼è‡´æŸäº›èŠ‚ç‚¹è¢«å¼•ç”¨ä¸Šåƒæ¬¡
2. **W çŸ©é˜µç¨ å¯†åŒ–**ï¼šæ¨é€æ“ä½œå¤æ‚åº¦çˆ†ç‚¸
3. EP çš„ç†è®ºä¼˜åŠ¿ O(1) PDE æ±‚è§£è¢« algo4 çš„ O(EÃ—dÂ²) åƒæ‰

### ç»“è®º

EP çš„ä¼˜åŠ¿åœ¨äº**é¿å…é‡å¤æ„å»º tape**ï¼Œè€Œä¸æ˜¯ Hessian è®¡ç®—æœ¬èº«æ›´å¿«ã€‚
å½“å¯¹æ¯”çº¯æ•°å€¼ Bumping2 æ—¶ï¼ŒEP æ²¡æœ‰ä¼˜åŠ¿ã€‚

### ä¸‹ä¸€æ­¥

éœ€è¦æ ¹æœ¬æ€§ä¼˜åŒ– algo4ï¼š
1. **å›¾ç°‡åŒ–**ï¼šåˆå¹¶ PDE æ—¶é—´æ­¥ä¸ºé»‘ç›’
2. **ç¨€ç–å­å›¾**ï¼šåªè¿½è¸ªä¸è¾“å…¥ç›¸å…³çš„è·¯å¾„
3. **å¹¶è¡ŒåŒ–**ï¼šOpenMP pushing stage

---

## 2025-12-02 01:30

### é‡è¦æ›´æ­£ï¼šæ€§èƒ½å¯¹æ¯”æ–¹æ³•è®ºé—®é¢˜

**é—®é¢˜å‘ç°**ï¼šä¹‹å‰çš„ "4.8Ã— åŠ é€Ÿ" ç»“è®ºå­˜åœ¨æ–¹æ³•è®ºé—®é¢˜

**åŸå§‹æµ‹è¯•ä»£ç ä¸­ Bumping2 çš„å®ç°**ï¼š
```python
for i in range(n_params):
    for j in range(i, n_params):
        r_pp = solver.solve_pde_with_aad(100.0, coeffs_pp, compute_hessian=False, ...)
        # æ¯æ¬¡éƒ½è°ƒç”¨ solve_pde_with_aadï¼Œè™½ç„¶ compute_hessian=False
        # ä½†ä»ç„¶ä¼šæ„å»ºå®Œæ•´çš„ AAD tapeï¼
```

**ä¸¤ç§ Bumping2 å®ç°çš„åŒºåˆ«**ï¼š
| å®ç°æ–¹å¼ | è¯´æ˜ | æ€§èƒ½ |
|---------|------|------|
| `solve_pde_with_aad(compute_hessian=False)` | ä»æ„å»º AAD tape | æ…¢ (~81s) |
| `Bumping2BSpline2D._solve_pde_simple()` | çº¯æ•°å€¼æ±‚è§£ï¼Œæ—  tape | å¿« (~1-10s) |

**ç»“è®º**ï¼š
- EP 17.10s vs Bumping2(with tape) 81.32s â†’ EP å¿« 4.8Ã—ï¼ˆ**ä¸å…¬å¹³å¯¹æ¯”**ï¼‰
- EP 8-13s vs Bumping2(pure numerical) 1-10s â†’ EP å¯èƒ½æ›´æ…¢ï¼ˆ**å…¬å¹³å¯¹æ¯”**ï¼‰

### æ ¹æœ¬é—®é¢˜
æ‰€è°“ "åŠ é€Ÿ" ä¸»è¦æ¥è‡ªé¿å…é‡å¤æ„å»º AAD tapeï¼Œè€Œä¸æ˜¯ Edge-Pushing ç®—æ³•æœ¬èº«æ¯”çº¯æ•°å€¼ Bumping2 æ›´å¿«ã€‚

### ä¸‹ä¸€æ­¥
- æ˜ç¡®å®šä¹‰å…¬å¹³å¯¹æ¯”åŸºå‡†
- åˆ†æ EP åœ¨å¤§è§„æ¨¡é—®é¢˜ä¸Šçš„çœŸå®ä¼˜åŠ¿

---

## 2025-12-02 00:30

### æ”¹è¿›å†…å®¹
- ä¿®å¤ Cython ç¼–è¯‘é—®é¢˜ï¼ˆé‡å†™ `symm_sparse_adjlist_cpp.pyx`ï¼Œä½¿ç”¨å†…è”ç±»å‹å®šä¹‰ï¼‰
- æˆåŠŸç¼–è¯‘ `algo4_cython_simple` å’Œ `symm_sparse_adjlist_cpp` æ¨¡å—
- ä¸º `pde_aad_bspline_2d.py` æ·»åŠ  Cythonâ†’Pure Python fallback æœºåˆ¶

### æµ‹è¯•æ•ˆæœ
- EP vs Bumping2 Hessian ç²¾åº¦éªŒè¯é€šè¿‡ï¼ˆæœ€å¤§ç›¸å¯¹è¯¯å·® 0.05%ï¼‰
- **16 params (4Ã—4), M=10, N=10**ï¼šEP 17.10s vs Bumping2(with tape) 81.32s
- æ³¨æ„ï¼šæ­¤ Bumping2 ä½¿ç”¨ `solve_pde_with_aad(compute_hessian=False)`ï¼Œéå…¬å¹³å¯¹æ¯”

### æ€§èƒ½åˆ†æ
- å‘ç° Edge-Pushing ç“¶é¢ˆï¼šPDE å›¾ç»“æ„å¯¼è‡´ W çŸ©é˜µå˜ç¨ å¯†
- algo4 åœ¨ç®€å•å›¾ä¸Š ~44ms (11K nodes)ï¼Œåœ¨ PDE å›¾ä¸Š ~24s (9K nodes)
- åŸå› ï¼šPDE å›¾ä¸­æŸèŠ‚ç‚¹è¢«å¼•ç”¨ 1040 æ¬¡ï¼Œpushing stage å¤æ‚åº¦é«˜
- Cython vs Pure Python: 24.5s vs 39.3s (1.6Ã— åŠ é€Ÿ)

### ä¸‹ä¸€æ­¥è®¡åˆ’
- ä¼˜åŒ– Edge-Pushing pushing stageï¼ˆå‡å°‘é‚»å±…éå†ï¼‰
- è€ƒè™‘ç¨€ç–å­å›¾ç­–ç•¥ï¼ˆåªè¿½è¸ªä¸è¾“å…¥ç›¸å…³çš„è·¯å¾„ï¼‰

---

## 2025-12-01 21:45

### æ”¹è¿›å†…å®¹
- ä¿®å¤ B-spline ç³»æ•°å…¬å¼ bugï¼ˆ`n = k + degree + 1` â†’ `n = degree + k - 1`ï¼‰
- åº”ç”¨æ•°å€¼ç²¾åº¦ä¼˜åŒ–ï¼ˆvar.py ä½¿ç”¨ np.float64ï¼Œarithmetic.py ä½¿ç”¨ np.squareï¼‰
- éªŒè¯ç¨€ç– Edge-Pushing ä¼˜åŒ–ï¼ˆget_active_parameters + æ¡ä»¶ Hessian è®¡ç®—ï¼‰

### æµ‹è¯•æ•ˆæœ
- EP vs BS ç†è®ºå€¼å·®å¼‚ä» 3.15% é™è‡³ 0.077%
- sigma(t=0) å’Œ sigma(t=1) éƒ½æ­£ç¡®è¿”å› 0.2
- B-spline å½¢çŠ¶ (6,6) ç¬¦åˆé¢„æœŸ

### ä¸‹ä¸€æ­¥è®¡åˆ’
- è¿è¡Œå®Œæ•´ Hessian æµ‹è¯•éªŒè¯ Edge-Pushing
- æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆç¨€ç– vs å…¨é‡ï¼‰

---

## 2025-12-01 17:30

### æ”¹è¿›å†…å®¹
- åˆå§‹åŒ– GitHub ä»“åº“ (xuenailao/AAD-Edgepushing-Bspline)
- ä¸Šä¼ æ ¸å¿ƒä»£ç  (aad_edge_pushing/)
- é…ç½®è‡ªåŠ¨ç‰ˆæœ¬æ§åˆ¶ pipeline (.claude/git-auto-push.sh)
- åˆ›å»ºå¼€å‘æ—¥å¿—ç³»ç»Ÿ (DEVLOG.md + /log + /devlog å‘½ä»¤)

### æµ‹è¯•æ•ˆæœ
- Stop hook è‡ªåŠ¨ commit + push åŠŸèƒ½æ­£å¸¸
- åªæäº¤æ ¸å¿ƒæ–‡ä»¶ï¼Œæ’é™¤æµ‹è¯•æ–‡ä»¶

### ä¸‹ä¸€æ­¥è®¡åˆ’
- ç»§ç»­å¼€å‘ AAD Edge Pushing ç®—æ³•
- å®Œå–„ 2D B-spline PDE æ±‚è§£å™¨

---
